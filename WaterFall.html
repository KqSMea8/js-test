<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <title></title>
    <style type="text/css">
            *{padding: 0;margin:0;}
    #main{
        position: relative;
    }
    .pin{
        padding: 15px 0 0 15px;
        float:left;
    }
    .box{
        padding: 10px;
        border:1px solid #ccc;
        box-shadow: 0 0 6px #ccc;
        border-radius: 5px;
    }
    .box img{
        width:162px;
        height:auto;
    }
    </style>
    </head>
    <body>
    <div id="main">
        <div class="pin">
            <div class="box">
                <img src="./images/0.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/1.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/2.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/3.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/4.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/5.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/6.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/7.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/8.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/9.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/10.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/11.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/12.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/13.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/14.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/15.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/16.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/17.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/18.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/0.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/1.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/2.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/3.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/4.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/5.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/6.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/7.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/8.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/9.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/10.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/11.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/12.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/13.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/14.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/15.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/16.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/17.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/18.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/0.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/1.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/2.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/3.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/4.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/5.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/6.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/7.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/8.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/9.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/10.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/11.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/12.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/13.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/14.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/15.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/16.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/17.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/18.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/0.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/1.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/2.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/3.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/4.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/5.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/6.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/7.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/8.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/9.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/10.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/11.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/12.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/13.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/14.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/15.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/16.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/17.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/18.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/0.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/1.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/2.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/3.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/4.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/5.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/6.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/7.jpeg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/8.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/9.jpg"/>
            </div>
        </div>
        <div class="pin">
            <div class="box">
                <img src="./images/10.jpeg"/>
            </div>
        </div>

     </div>
    </body>
    <script>
        (function (window) {
            var WaterFall = function (options) {
                return new WaterFall.prototype.init(options)
            };
            WaterFall.prototype = {
                constructor : WaterFall,
                init:function (options) {
                    var _self = this,
                            main = options.main;
                    this.water(main);
                    window.onscroll = function () {
                        if(_self.checkscroll(main)){
                            var dataInt={'data':[{'src':'1.jpeg'},{'src':'2.jpg'},{'src':'3.jpeg'},{'src':'4.jpg'}]};
                            for(var i=0;i<dataInt.data.length;i++){
                                var oPin=document.createElement('div');
                                oPin.className='pin';
                                main.appendChild(oPin);
                                var oBox=document.createElement('div');
                                oBox.className='box';
                                oPin.appendChild(oBox);
                                var oImg=document.createElement('img');
                                oImg.src='./images/'+dataInt.data[i].src;
                                oBox.appendChild(oImg);
                            }
                            _self.water(main);
                        }
                    }

                },
                water : function (main) {
                    var PinClass = [].slice.call(document.querySelectorAll('.pin')),
                            iPinW = PinClass[0].offsetWidth,
                            num = Math.floor(window.innerWidth/iPinW,10);
                    main.parentNode.style.cssText = 'width:' + iPinW * num + 'px;margin:0 auto';
                    var pinHArr = [];
                    for(var i = 0, len = PinClass.length; i < len ;i++){
                        var pinH = PinClass[i].offsetHeight;
                        if(i < num){
                            pinHArr[i] = pinH;
                        }else{
//                            var minH = Math.min(...pinHArr);
                            var minH = Math.min.apply(null,pinHArr),
                                    index = pinHArr.indexOf(minH);
                            this.setCss(PinClass[i],{
                                'position' : 'absolute',
                                'top' : minH + 'px',
                                'left' : PinClass[index].offsetLeft + 'px'
                            });
                            pinHArr[index] += PinClass[i].offsetHeight;
                        }
                    }
                },
                setCss : function (_this, Option){
                    if(!_this || _this.nodeType !== 3 || _this.nodeType !== 8 || !_this.style){
                        for(var cs in Option){
                            _this.style[cs] = Option[cs];
                        }
                    }
                    return _this;
                },
                checkscroll : function (main) {
                    var PinClass = [].slice.call(document.querySelectorAll('.pin')),
                            lastPinH = this.getAbsoluteTop(PinClass[PinClass.length - 1]) + Math.floor(PinClass[PinClass.length-1].offsetHeight/2 , 10),
                            scrollTop = window.pageYOffset || document.documentElement.scrollTop||document.body.scrollTop;
                    return (lastPinH > scrollTop) ? true : false;
                },
                getAbsoluteTop : function (_e) {
                    var _top = _e.offsetTop,
                            _current = _e.offsetParent;
                    while(_current !== null){
                        _top += _current.offsetTop;
                        _current = _current.offsetParent;
                    }
                    return _top;
                },
            }

            WaterFall.prototype.init.prototype = WaterFall.prototype;
            window.WaterFall = WaterFall;

        })(window, undefined)
        window.onload = function () {
            WaterFall({
                'main' : document.querySelector('#main')
            })
        }
    </script>
</html>